#:kivy 1.10.0
<NumericInput>:
  orientation: 'vertical'
  cols: 2
  text: "hello"
  # padding: 3
  spacing: 5
  Label:
    text:root.text
  Button:
    background_color: .2, .2, .2, 2
    size_hint_x: None
    width:32
    text: '+'
    disabled: root.value >= root.max
    on_release:
      root.value += root.step
      root.value = min(root.value, root.max)
  TextInput:
    text: str(root.value)
    background_color: .33,.33,.33,1
    foreground_color: 1,1,1,1
  Button:
    background_color: .2, .2, .2, 2
    size_hint_x: None
    width:32
    text: '-'
    disabled: root.value <= root.min
    on_release:
      root.value -= root.step
      root.value = max(root.value, root.min)
<Transport>:
  canvas.before:
    Color:
      rgba: .15, .15, .15, 1
    Rectangle:
      size: self.size
      pos: self.pos
  height:400
  size_hint_y:None
  spacing:10
  padding:10
  id:transport
  BoxLayout:
    NumericInput:
      text:"BPM"
    NumericInput:
      text:"TPB"
    NumericInput:
      text:"BPB"
    NumericInput:
      text:"OCT"
    Button:
      text:"Open Project"
      on_press:root.button_open_project()
    Button:
      text:"Save Project"
      on_press:root.button_save_project()
    Button:
      text:"Options"
      on_press:root.button_options()
    Button:
      text:"<"
      on_press:root.button_stop()
    Button:
      text:"Play"
      on_press:root.button_play()
    Button:
      text:"Stop"
      on_press:root.button_stop()
    Button:
      text:">"
      on_press:root.button_stop()
    ToggleButton:
      text:"Loop"
      on_press:root.button_loop(self)
    Slider:
      min: 1
      max: 100
    Label:
      text:"Bpm"
    TextInput:
      background_color: .33,.33,.33,1
      foreground_color: 1,1,1,1
      input_filter: "int"
      text:"120"
      size_hint: (None, 1)
      font_size: "24sp"
      multiline: False
      size:(50, 10)
      on_text_validate: root.bpm_text(self)
    Button:
      text:"About"
      on_press:root.button_about()
<Row>:
  background_color: .33,.33,.33,1 
  value: ''
  size_hint_y:.1
  height:10
  id: r_but
  on_press: root.button_pressed()
  text: root.value

<FilenameLister>:
  id:rv
  scroll_type: ['bars','content']
  scroll_wheel_distance: dp(114)
  bar_width: dp(10)
  viewclass: 'Row'
  RecycleBoxLayout:
    default_size: None, dp(25)
    default_size_hint: 1, None
    size_hint_y: None
    height: self.minimum_height
    orientation: 'vertical'
    spacing: dp(2)

<StepPanelMain>:
  id:rv3
  scroll_type: ['bars','content']
  scroll_wheel_distance: dp(114)
  bar_width: dp(10)
  viewclass: 'StepRow'
  # RecycleBoxLayout:
  #   default_size: None, dp(25)
  #   default_size_hint: 1, None
  #   size_hint_y: None
  #   height: self.minimum_height
  #   orientation: 'vertical'
  #   spacing: dp(2)

<StepPanel_grid_base>:
  canvas.before:
    Color:
      rgba: 0, 1, 0, 1
    Rectangle:
      size: self.size
      pos: self.pos
  padding:20
  id:rv2
  # size_hint_y: 1
  # scroll_type: ['bars']
  # scroll_wheel_distance: dp(114)
  # bar_width: dp(10)
  # default_size: None, dp(60)
  # default_size_hint: 1, None
  # size_hint_y: None
  # height: self.minimum_height
  # orientation: 'vertical'
  # spacing: 50
  # viewclass: 'StepRow'
  # RecycleBoxLayout:
  #   default_size: None, dp(60)
  #   default_size_hint: 1, None
  #   size_hint_y: None
  #   height: self.minimum_height
  #   orientation: 'vertical'
  #   spacing: dp(30)
  # RecycleBoxLayout:
  #     default_size: None, dp(60)
  #     default_size_hint: 1, None
  #     size_hint_y: None
  #     height: self.minimum_height
  #     orientation: 'vertical'
  #     spacing: dp(30)
<StepPanel2_grid>:
  canvas.before:
    Color:
      rgba: 0, 0, 1, 1
    Rectangle:
      size: self.size
      pos: self.pos
  height: self.minimum_height
  size_hint_y: 1
<StepRowPanel>:
  canvas.before:
    Color:
      rgba: 0, 0, 1, 1
    Rectangle:
      size: self.size
      pos: self.pos
  # default_size: None, dp(60)
  # default_size_hint: 1, None
  # size_hint_y: None
  # height: self.minimum_height
  # orientation: 'vertical'
  # spacing: 50
  id:"steppan"
<StepButton>:
  size_hint_x:1
  size_hint_y:1
  spacing:100
  background_color: .33,.33,.33, 1
  # id: "s_but"
  step_id: root.step_id
  # text: root.step_id
  on_press:root.button_pressed(self.id)

<StepRow>:
  canvas.before:
    Color:
      rgba: 0.3, 0.3, 0.3, 1
    Rectangle:
      size: self.size
      pos: self.pos
  padding: 10
  spacing: 50
  size_hint_x:1
  size_hint_y:None
  height:100
  id: s_row
  fn: "fn"
  # on_touch_down: root.button_pressed()
  orientation: "horizontal"
  BoxLayout:
    background_color: 1, 0, 0, 0
    orientation: "horizontal"
    cols:4 
    # padding:50
    # size_hint_x:1
    # size_hint_y:1
    # spacing: 150
    Label:
      text: str(s1.value) + root.fn
      color: 1, 0, 0, 1
      font_size:'15sp'
      size_hint_x:.1
    Button:
      text:"Remove Track"
      on_press:root.button_pressed()
      size_hint_x:.1
    Slider:
      id: s1
      orientation:"horizontal"
      size_hint_x:.1
      on_value:root.slider_change(self.value)
      min:0.01
      max:0.900
      value:0.125
      value_track: True
      value_track_color: [0,1,0,1]
    BoxLayout:
      size_hint_x:1
      size_hint_y:1
      cols: 1
      StepButton:
        step_id:'1'
      StepButton:
        step_id:'2'
      StepButton:
        step_id:'3'
      StepButton:
      StepButton:
      StepButton:
      StepButton:
      StepButton:
      StepButton:
      StepButton:
      StepButton:
      StepButton:
      StepButton:
      StepButton:
      StepButton:
      StepButton:
<SequencerLayout>:
  canvas.before:
    Color:
      rgba: .17, .17, .17, 1
    Rectangle:
      size: self.size
      pos: self.pos
  orientation: "horizontal"
  padding: 20
  spacing: 20


<LoadDialog>:
  BoxLayout:
    size: root.size
    pos: root.pos
    orientation: "vertical"
    FileChooserListView:
      id: filechooser

      BoxLayout:
        size_hint_y: None
        height: 30
        Button:
          text: "Cancel"
          on_release: root.cancel()

        Button:
          text: "Load"
          on_release: root.load(filechooser.path, filechooser.selection, app.root.sgr.audio_items, app.root.sgr.canvas)


<SaveDialog>:
  text_input: text_input
  BoxLayout:
    size: root.size
    pos: root.pos
    orientation: "vertical"
    FileChooserListView:
      id: filechooser
      on_selection: text_input.text = self.selection and self.selection[0] or ''

    TextInput:
      id: text_input
      size_hint_y: None
      height: 30
      multiline: False

    BoxLayout:
      size_hint_y: None
      height: 30
      Button:
        text: "Cancel"
        on_release: root.cancel()

      Button:
        text: "Save"
        # on_release: app.root.file_system.write_project_file(app.root.sgr.audio_items, filechooser.path+text_input.text)
        on_release: root.save(filechooser.path, text_input.text, app.root.sgr.audio_items)